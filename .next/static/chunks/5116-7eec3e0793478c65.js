"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5116],{1618:(e,t,o)=>{o.d(t,{h:()=>a});var i=o(7985),n=o(1218);let r={fallbackLng:"en",debug:!1,interpolation:{escapeValue:!1},ns:["home","subscription","common","auth","admin","leaderboard","profile","rules","faq","ethos","submission"],defaultNS:"common",react:{useSuspense:!1},resources:{en:{common:{loading:"Loading...",error:"Error",submit:"Submit",cancel:"Cancel"}}}};i.Ay.isInitialized||o.e(4431).then(o.bind(o,4431)).then(e=>{o.e(8834).then(o.bind(o,8834)).then(t=>{i.Ay.use(t.default).use(e.default).use(n.r9).init({...r,backend:{loadPath:"/locales/{{lng}}/{{ns}}.json",crossDomain:!1},detection:{order:["localStorage","navigator","htmlTag"],caches:["localStorage"]},preload:["en"]})})}),i.Ay;let a=()=>[{code:"en",name:"English",flag:"\uD83C\uDDFA\uD83C\uDDF8",dir:"ltr"},{code:"es",name:"Espa\xf1ol",flag:"\uD83C\uDDEA\uD83C\uDDF8",dir:"ltr"},{code:"fr",name:"Fran\xe7ais",flag:"\uD83C\uDDEB\uD83C\uDDF7",dir:"ltr"},{code:"de",name:"Deutsch",flag:"\uD83C\uDDE9\uD83C\uDDEA",dir:"ltr"},{code:"pt",name:"Portugu\xeas",flag:"\uD83C\uDDE7\uD83C\uDDF7",dir:"ltr"},{code:"zh",name:"中文",flag:"\uD83C\uDDE8\uD83C\uDDF3",dir:"ltr"},{code:"ja",name:"日本語",flag:"\uD83C\uDDEF\uD83C\uDDF5",dir:"ltr"},{code:"ko",name:"한국어",flag:"\uD83C\uDDF0\uD83C\uDDF7",dir:"ltr"},{code:"ar",name:"العربية",flag:"\uD83C\uDDF8\uD83C\uDDE6",dir:"rtl"}]},3168:(e,t,o)=>{o.d(t,{M3:()=>l,ND:()=>s,yz:()=>c});var i=o(5647),n=o(9509);let r="https://yqnikgupiaghgjtsaypr.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlxbmlrZ3VwaWFnaGdqdHNheXByIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc5NDIzMDMsImV4cCI6MjA2MzUxODMwM30.3rR9EyNlWSLZAoYqlCa3MOJobHH7RHjak0m_3mI6YZs";if(window.__SUPABASE_LOGGED__||(console.log("\uD83D\uDD27 Supabase Environment Check:",{url:r?"✓ Loaded":"✗ Missing",key:a?"✓ Loaded":"✗ Missing",nodeEnv:"production",allPublicEnvs:Object.keys(n.env).filter(e=>e.startsWith("NEXT_PUBLIC_"))}),window.__SUPABASE_LOGGED__=!0),!r||!a)throw console.error("❌ Supabase Configuration Error:","Missing required Supabase environment variables:\n  - NEXT_PUBLIC_SUPABASE_URL: ".concat(r?"✓":"✗","\n  - NEXT_PUBLIC_SUPABASE_ANON_KEY: ").concat(a?"✓":"✗","\n  \n  Please ensure these are set in your .env.local file and restart the development server.")),console.error("\uD83C\uDF10 Client-side environment variables not loaded. This usually means the dev server needs to be restarted."),Error("Missing required Supabase environment variables");let l=()=>{{let e=window.location.host,t=window.location.protocol;return"".concat(t,"//").concat(e,"/auth/callback")}},s=(0,i.UU)(r,a,{auth:{persistSession:!0,storageKey:"pullupclub-auth",detectSessionInUrl:!1,autoRefreshToken:!0,debug:!1,storage:{getItem:e=>{try{return localStorage.getItem(e)}catch(e){return console.warn("Error reading from localStorage:",e),null}},setItem:(e,t)=>{try{localStorage.setItem(e,t)}catch(e){console.warn("Error writing to localStorage:",e)}},removeItem:e=>{try{localStorage.removeItem(e)}catch(e){console.warn("Error removing from localStorage:",e)}}}}}),c=!1},3684:(e,t,o)=>{o.d(t,{OF:()=>r,ZE:()=>n});var i=o(9509);let n={pullUpClub:{price:9.99,name:"Monthly Membership",description:"Access to all Pull-Up Club features",interval:"month",productId:"prod_SH8uXKHPtjHbke",paymentLink:"https://buy.stripe.com/dRmdR9dos2kmaQcdHGejK00"},pullUpClubAnnual:{price:99.99,name:"Annual Membership",description:"Access to all Pull-Up Club features, billed annually",interval:"year",productId:"prod_SH8vqXMcQi0qFQ",paymentLink:"https://buy.stripe.com/28EcN5dosf784rO0UUejK01"}};window.location.origin,window.location.origin;let r={monthly:i.env.NEXT_PUBLIC_STRIPE_MONTHLY_PRICE_ID,annual:i.env.NEXT_PUBLIC_STRIPE_ANNUAL_PRICE_ID}},4584:(e,t,o)=>{o.d(t,{sx:()=>i}),o(1195);let i=(e,t,o,i)=>{}},5731:(e,t,o)=>{o.d(t,{As:()=>d,OJ:()=>u});var i=o(5155),n=o(2115),r=o(5695),a=o(3168),l=o(8043);let s=(0,n.createContext)({user:null,profile:null,isAdmin:!1,subscriptionState:"loading",isLoading:!1,isFirstLogin:!1,signIn:async()=>{},signUp:async()=>{},signOut:async()=>{},resetPassword:async()=>{},processPendingSubscription:async()=>{},fetchProfile:async()=>{},evaluateSubscription:async()=>"unpaid",setProfile:()=>{},signInWithProvider:async()=>{},updatePassword:async()=>{},refreshProfile:async()=>{},updateProfileSettings:async()=>{}}),c={user_settings:{},notification_preferences:{email_notifications:!0,workout_reminders:!0,subscription_reminders:!0,achievement_notifications:!0,leaderboard_updates:!0},theme_preferences:{theme:"light",color_scheme:"default",font_size:"medium"},privacy_settings:{show_profile:!0,show_stats:!0,show_achievements:!0,show_activity:!0}},u=e=>{let{children:t}=e,[o,u]=(0,n.useState)(null),[d,p]=(0,n.useState)(null),[g,h]=(0,n.useState)(!1),[f,m]=(0,n.useState)(!0),[_,w]=(0,n.useState)(!1),[y,v]=(0,n.useState)("loading"),[S,A]=(0,n.useState)(!1),[b,C]=(0,n.useState)(!1),x=(0,r.useRouter)(),N=(0,r.usePathname)();(0,n.useEffect)(()=>{let e=setTimeout(()=>{f&&(console.warn("[AuthContext] Forcing loading to false after timeout"),m(!1))},1e4);return()=>clearTimeout(e)},[f]),(0,n.useEffect)(()=>{(async()=>{if(f)return console.log("[AuthContext] Auth flow skipped - loading");if(console.log("[AuthContext] Processing auth flow:",{path:N,hasUser:!!o,hasProfile:!!d,isPaid:null==d?void 0:d.is_paid,isComplete:null==d?void 0:d.is_profile_completed}),(null==o?void 0:o.id)&&!(null==d?void 0:d.is_paid)&&"/subscription"!==N){console.log("[AuthContext] Payment required before proceeding"),x.replace("/subscription");return}if(!(null==o?void 0:o.id)){N&&["/profile","/submit","/admin-dashboard","/create-account"].includes(N)&&(console.log("[AuthContext] No auth: redirecting to login"),x.replace("/login"));return}if((null==o?void 0:o.id)&&(null==d?void 0:d.id)&&!d.is_profile_completed){if(N&&!["/profile","/create-account"].includes(N)&&"/login"!==N){console.log("[AuthContext] Profile completion required - redirecting to profile"),x.replace("/profile");return}"/login"===N&&(console.log("[AuthContext] Profile completion required - redirecting to profile from login"),x.replace("/profile"));return}(null==o?void 0:o.id)&&(null==d?void 0:d.id)&&d.is_paid&&d.is_profile_completed&&("/login"===N||"/create-account"===N||"/subscription"===N)&&(console.log("[AuthContext] Auth complete: redirecting to profile"),x.replace("/profile"))})()},[o,d,f,N,x]),(0,n.useEffect)(()=>{(async()=>{let{data:{session:e}}=await a.ND.auth.getSession();e||(u(null),p(null))})()},[]);let E=async(e,t)=>{if(!e||!t)return void console.log("[AuthContext] handlePostAuthSubscription: Missing user or plan.");m(!0);try{let{error:o}=await a.ND.rpc("handle_pending_subscription",{user_id:e.id,plan_data:{plan:t,timestamp:new Date().toISOString()}});if(o)throw o;console.log("[AuthContext] User ".concat(e.email," proceeding to ").concat(t," subscription."));let i=await (0,l.fw)(t,e.email,{userId:e.id});console.log("[AuthContext] Checkout URL received:",i),i?window.location.href=i:(console.error("[AuthContext] Checkout URL is null or undefined."),x.push("/subscription?error=checkout_url_missing"),m(!1))}catch(e){console.error("[AuthContext] Post-auth subscription error:",e),x.push("/subscription?error=checkout_failed"),m(!1)}},I=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{let r,[{data:{session:l}},s,{data:u}]=await Promise.all([a.ND.auth.getSession(),a.ND.from("profiles").select("*").eq("id",e).single(),a.ND.from("admin_roles").select("*").eq("user_id",e).single()]);r=s.data;let d=s.error,g=!!u;if(w(g),l&&U(e,l).catch(console.error),console.log("[AuthContext] Profile query complete. Error:",d,"Data:",r),d){if(t<3)return console.log("[AuthContext] Retrying profile fetch..."),await new Promise(e=>setTimeout(e,1e3)),I(e,t+1);throw d}if(!r){var o,i,n;console.log("[AuthContext] No profile found, creating new profile");let{data:t,error:s}=await a.ND.from("profiles").insert([{id:e,user_id:e,email:null==l||null==(o=l.user)?void 0:o.email,full_name:null,age:null,gender:null,organization:null,region:"",phone:null,stripe_customer_id:null,is_paid:(null==l||null==(n=l.user)||null==(i=n.user_metadata)?void 0:i.is_paid)||!1,paypal_email:null,role:g?"admin":"user",badges:[],is_profile_completed:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),notification_preferences:c.notification_preferences,theme_preferences:c.theme_preferences,privacy_settings:c.privacy_settings,user_settings:c.user_settings}]).select().single();if(s)throw s;r=t}if(!r.user_id){console.log("[AuthContext] Fixing missing user_id");let{error:t}=await a.ND.from("profiles").update({user_id:e}).eq("id",e);t&&console.error("[AuthContext] Error updating user_id:",t),r.user_id=e}console.log("[AuthContext] Mapping profile data to context format");let h={id:r.id,user_id:r.user_id||e,email:r.email,full_name:r.full_name||null,age:r.age||null,gender:r.gender||null,organization:r.organization||null,region:r.region||"",phone:r.phone||null,social_media:r.social_media||null,stripe_customer_id:r.stripe_customer_id||null,is_paid:r.is_paid||!1,paypal_email:r.paypal_email||null,role:r.role||"user",badges:r.badges||[],is_profile_completed:r.is_profile_completed||!1,created_at:r.created_at,updated_at:r.updated_at,notification_preferences:r.notification_preferences||c.notification_preferences,theme_preferences:r.theme_preferences||c.theme_preferences,privacy_settings:r.privacy_settings||c.privacy_settings,user_settings:r.user_settings||{}};console.log("[AuthContext] Setting profile object:",h),p(h),console.log("[AuthContext] Profile fetch completed successfully")}catch(o){if(console.error("[AuthContext] Error in fetchProfile:",o),t<3)return console.log("[AuthContext] Retrying profile fetch..."),await new Promise(e=>setTimeout(e,1e3)),I(e,t+1);throw o}},P=async e=>{console.log("[AuthContext] processPendingSubscription called for user:",e.email);try{var t;let{data:i,error:n}=await a.ND.from("profiles").select("pending_subscription_plan").eq("id",e.id).single();if(n)throw n;let r=null==i||null==(t=i.pending_subscription_plan)?void 0:t.plan;r?(await a.ND.rpc("clear_pending_subscription",{user_id:e.id}),await E(e,r)):(console.log("[AuthContext] No pending plan in database."),("/login"===N||"/create-account"===N)&&o&&(null==d?void 0:d.is_paid)&&(null==d?void 0:d.is_profile_completed)&&(console.log("[AuthContext] Redirecting from auth route to profile"),x.push("/profile")))}catch(e){console.error("[AuthContext] Error processing pending subscription:",e)}},D=async(e,t)=>{if(o)try{let{error:i}=await a.ND.from("profiles").update({[e]:t,updated_at:new Date().toISOString()}).eq("id",o.id);if(i)throw i;d&&p({...d,[e]:{...d[e],...t}})}catch(t){throw console.error("Error updating ".concat(e,":"),t),t}},k=async()=>{(null==o?void 0:o.id)&&await I(o.id)},U=async(e,t)=>{try{let o=t.user.user_metadata||{},i=!0===o.is_paid||"true"===o.is_paid,n=o.stripe_customer_id,{data:r}=await a.ND.from("profiles").select("is_paid, stripe_customer_id").eq("id",e).single();if(!r)return;if(i&&!r.is_paid||n&&!r.stripe_customer_id){console.log("[AuthContext] Syncing metadata to profile:",{metadata_is_paid:i,profile_is_paid:r.is_paid,metadata_customer_id:n,profile_customer_id:r.stripe_customer_id});let t={updated_at:new Date().toISOString()};i&&!r.is_paid&&(t.is_paid=!0),n&&!r.stripe_customer_id&&(t.stripe_customer_id=n);let{error:o}=await a.ND.from("profiles").update(t).eq("id",e);o?console.error("[AuthContext] Error syncing metadata:",o):console.log("[AuthContext] Successfully synced metadata to profile")}}catch(e){console.error("[AuthContext] Error in syncMetadataToProfile:",e)}},O=(0,n.useCallback)(async()=>{try{if(console.log("[AuthContext] Evaluating subscription status"),(null==d?void 0:d.is_paid)===!0)return console.log("[AuthContext] User marked as paid in profile"),v("active"),"active";console.log("[AuthContext] Checking Stripe subscription");let e=await (0,l.UF)(),t=!!e&&(null==e?void 0:e.status)==="active",o=t?"active":"unpaid";return console.log("[AuthContext] Setting subscription state:",o),v(o),t&&d&&!d.is_paid&&(console.log("[AuthContext] Syncing profile paid status with Stripe"),await a.ND.from("profiles").update({is_paid:!0}).eq("id",d.id)),o}catch(e){return console.warn("[AuthContext] Subscription evaluation failed:",e),v("unpaid"),"unpaid"}},[d]);(0,n.useEffect)(()=>{d&&o&&(console.log("[AuthContext] Profile updated, re-evaluating subscription. is_paid:",d.is_paid),O())},[null==d?void 0:d.is_paid,null==o?void 0:o.id]);let T=(0,n.useCallback)(I,[]),q=(0,n.useCallback)(P,[N,x]);(0,n.useEffect)(()=>{C(!0)},[]),(0,n.useEffect)(()=>{if(!b)return;if(S)return void console.log("[AuthContext] Already initialized, skipping");A(!0);let e=null;(async()=>{try{let{data:{session:e}}=await a.ND.auth.getSession();if(null==e?void 0:e.user){let t={id:e.user.id,email:e.user.email};u(t);let{error:o}=await a.ND.from("profiles").select("id").limit(1);if(o&&(o.message.includes("JWT")||o.message.includes("expired"))){console.log("\uD83D\uDD04 Invalid session detected during init, signing out..."),await a.ND.auth.signOut({scope:"local"}),m(!1);return}try{await I(t.id),await O()}catch(e){console.error("Profile fetch error:",e),await a.ND.auth.signOut({scope:"local"})}}else console.log("[AuthContext] No session found during init"),v("unpaid")}catch(e){console.warn("initAuth getSession failed",e),await a.ND.auth.signOut({scope:"local"})}finally{m(!1)}})();let{data:{subscription:t}}=a.ND.auth.onAuthStateChange(async(e,t)=>{var o;if(console.log("[AuthContext] onAuthStateChange event: ".concat(e,", User: ").concat(null==t||null==(o=t.user)?void 0:o.email)),f)return void console.log("[AuthContext] Skipping auth state change while loading");if("SIGNED_IN"===e&&(null==t?void 0:t.user)){console.log("[AuthContext] Processing SIGNED_IN event"),m(!0);try{let{error:e}=await a.ND.from("profiles").select("id").limit(1);if(e&&(e.message.includes("JWT")||e.message.includes("expired"))){console.log("\uD83D\uDD04 Invalid session detected in auth change, signing out..."),await a.ND.auth.signOut({scope:"local"});return}let o={id:t.user.id,email:t.user.email};u(o),v("loading"),await T(t.user.id),await O(),await q(o),console.log("[AuthContext] SIGNED_IN processing complete")}catch(e){console.error("[AuthContext] Error processing sign in:",e),v("unpaid"),await a.ND.auth.signOut({scope:"local"})}finally{m(!1)}}else if("SIGNED_OUT"===e){console.log("[AuthContext] Processing SIGNED_OUT event"),u(null),p(null),h(!1),w(!1),v("loading");try{localStorage.removeItem("pullupclub-auth"),document.cookie="pullupclub-auth=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; secure; samesite=strict"}catch(e){console.warn("[AuthContext] Error clearing stored session:",e)}}});return e=t,()=>{e&&e.unsubscribe()}},[b]);let L=async(e,t)=>{console.log("[AuthContext] signIn called for:",e),m(!0);try{if(a.yz&&"dev@example.com"===e&&"dev123"===t){console.log("[AuthContext] Processing dev mode sign in");let e={id:"dev-user-id",email:"dev@example.com"};u(e),v("loading");let t={id:"dev-user-id",user_id:"dev-user-id",email:"dev@example.com",full_name:null,age:null,gender:null,organization:null,region:"",phone:null,social_media:null,stripe_customer_id:null,is_paid:!1,paypal_email:null,role:"user",badges:[],is_profile_completed:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),...c};p(t),await O(),await q(e),h(!0),console.log("[AuthContext] Dev mode sign in complete"),m(!1);return}let{data:{session:o},error:i}=await a.ND.auth.signInWithPassword({email:e,password:t});if(i)throw console.error("[AuthContext] Supabase signIn error:",i),m(!1),i;if(console.log("[AuthContext] Supabase signIn successful. Session:",o),!(null==o?void 0:o.user))throw console.error("[AuthContext] No user in session after sign in"),m(!1),Error("No user in session after sign in");let n={id:o.user.id,email:o.user.email};u(n),v("loading");try{await T(o.user.id),await O(),console.log("[AuthContext] Sign in processing complete")}catch(e){throw console.error("[AuthContext] Error processing sign in:",e),v("unpaid"),e}finally{m(!1)}}catch(e){throw m(!1),e}},M=async(e,t)=>{console.log("[AuthContext] signUp called for:",e),m(!0);try{if(a.yz&&"dev@example.com"===e&&"dev123"===t){console.log("[AuthContext] Processing dev mode sign up"),u({id:"dev-user-id",email:"dev@example.com"}),v("loading");let e={id:"dev-user-id",user_id:"dev-user-id",email:"dev@example.com",full_name:null,age:null,gender:null,organization:null,region:"",phone:null,social_media:null,stripe_customer_id:null,is_paid:!1,paypal_email:null,role:"user",badges:[],is_profile_completed:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),user_settings:{},notification_preferences:c.notification_preferences,theme_preferences:c.theme_preferences,privacy_settings:c.privacy_settings};p(e),h(!0),console.log("[AuthContext] Dev mode sign up complete"),m(!1);return}let{data:o,error:i}=await a.ND.auth.signUp({email:e,password:t,options:{emailRedirectTo:"".concat((0,a.M3)(),"subscription")}});if(i)throw console.error("[AuthContext] Supabase signUp error:",i),i;if(!(null==o?void 0:o.user)){console.warn("[AuthContext] No user object in signUp response"),h(!0);return}let n={id:o.user.id,email:o.user.email};console.log("[AuthContext] User created, proceeding to subscription"),u(n),v("unpaid"),await T(n.id),h(!0),x.replace("/subscription")}catch(e){throw console.error("[AuthContext] Sign up failed:",e),v("unpaid"),e}finally{m(!1)}},R=async e=>{let{error:t}=await a.ND.auth.signInWithOAuth({provider:e,options:{redirectTo:"".concat((0,a.M3)(),"profile")}});if(t)throw t},z=async e=>{"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||window.location.hostname.includes("localhost");let t="".concat(window.location.origin,"/reset-password");console.log("\uD83D\uDD17 AuthContext resetPassword with redirect URL:",t);let{error:o}=await a.ND.auth.resetPasswordForEmail(e,{redirectTo:t});if(o)throw o},j=async e=>{let{error:t}=await a.ND.auth.updateUser({password:e});if(t)throw t},B=async()=>{console.log("[AuthContext] Signing out user"),await a.ND.auth.signOut({scope:"local"}),u(null),p(null),h(!1),w(!1),v("loading"),x.push("/")};return(0,i.jsx)(s.Provider,{value:{user:o,profile:d,isAdmin:_,subscriptionState:y,isLoading:f,isFirstLogin:g,signIn:L,signUp:M,signOut:B,resetPassword:z,processPendingSubscription:P,fetchProfile:I,evaluateSubscription:O,setProfile:p,signInWithProvider:R,updatePassword:j,refreshProfile:k,updateProfileSettings:D},children:t})};function d(){let e=(0,n.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8043:(e,t,o)=>{o.d(t,{UF:()=>d,f:()=>c,fY:()=>g,fw:()=>s,pK:()=>p,tA:()=>l});var i=o(3684),n=o(3168),r=o(7368);o(4584);let a="pk_live_51RLYUyGaHiDfsUfBuCj8Wlw6vrQA50vyhiBi5v3lnfm3byAQpYzkqqX1ElIyEb0Alxi4IXFB2ozxmMlRKSdOKNTH00mdn192Oo",l=a?(0,r.c)(a):null;async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"monthly",t=arguments.length>1?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let r=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;for(let o=0;o<e;o++){let{data:{session:e},error:o}=await n.ND.auth.getSession();if(e&&!o)return e;await new Promise(e=>setTimeout(e,t))}return null},a=await r();if(!a)throw console.warn("createCheckoutSession: No authenticated session; cannot create checkout"),Error("Authentication required. Please sign in to continue.");let l="monthly"===e?i.OF.monthly:i.OF.annual;console.log("Creating checkout session with priceId: ".concat(l,", plan: ").concat(e));let s=t||a.user.email;if(!s)throw Error("Customer email is required for checkout");let c={priceId:l,customerEmail:s,successUrl:"".concat(window.location.origin,"/success?checkout=completed&plan=").concat(e),cancelUrl:"".concat(window.location.origin,"/subscription"),metadata:{...o,userId:a.user.id,plan:e}};console.log("Sending request body to create-checkout:",JSON.stringify(c));let u=await fetch("/api/stripe/create-checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.access_token)},body:JSON.stringify(c)});if(!u.ok){let e=await u.json();throw Error(e.error||"Checkout API request failed")}let d=await u.json();if(!(null==d?void 0:d.url))throw console.error("No checkout URL returned",d),Error("No checkout URL returned from Stripe");return d.url}catch(e){throw console.error("Error in createCheckoutSession:",e),e}}async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:999;try{let{data:t,error:o}=await n.ND.functions.invoke("create-payment-intent",{body:{amount:e}});if(o)return console.error("Error creating payment intent:",o),null;return{clientSecret:t.clientSecret}}catch(e){return console.error("Error creating payment intent:",e),null}}async function u(){try{let{data:e,error:t}=await n.ND.functions.invoke("customer-portal",{body:{returnUrl:"".concat(window.location.origin,"/profile")}});if(t)return console.error("Error creating customer portal session:",t),null;return e.url}catch(e){return console.error("Error in createCustomerPortalSession:",e),null}}let d=async()=>{try{let e=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;for(let o=0;o<e;o++){let{data:{session:e},error:o}=await n.ND.auth.getSession();if(e&&!o)return e;await new Promise(e=>setTimeout(e,t))}return null},t=await e();if(!t)return console.warn("getActiveSubscription: No authenticated session; skipping subscription check"),null;let{data:o,error:i}=await n.ND.functions.invoke("subscription-status",{headers:{Authorization:"Bearer ".concat(t.access_token)}});if(i){if(401===i.status)return console.warn("getActiveSubscription: Session expired, signing out"),await n.ND.auth.signOut({scope:"local"}),null;throw i}return o}catch(e){throw console.error("Error getting subscription status:",e),e}};async function p(){try{let e=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;for(let o=0;o<e;o++){let{data:{session:e},error:o}=await n.ND.auth.getSession();if(e&&!o)return e;await new Promise(e=>setTimeout(e,t))}return null},t=await e();if(!t)throw console.warn("getPaymentHistory: No authenticated session; cannot fetch payments"),Error("Authentication required. Please sign in to continue.");let{data:o,error:i}=await n.ND.functions.invoke("get-payment-history",{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token)}});if(i)return console.error("Error fetching payment history:",i),[];if(!(null==o?void 0:o.payments))return[];return o.payments.map(e=>({id:e.id,amount:e.amount/100,status:e.status,date:new Date(1e3*e.created).toISOString(),receipt:e.receipt_url}))}catch(e){return console.error("Error in getPaymentHistory:",e),[]}}async function g(){try{let e=await u();if(!e)throw Error("Unable to open billing portal");window.location.assign(e)}catch(e){throw console.error("Error opening customer portal:",e),Error("Unable to access billing portal. Please try again later.")}}}}]);