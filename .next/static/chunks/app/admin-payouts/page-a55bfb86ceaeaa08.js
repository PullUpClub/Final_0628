(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[864],{1788:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},2915:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},5015:(e,t,a)=>{"use strict";a.d(t,{Gu:()=>l,W5:()=>r});var s=a(5155);a(2115);let l=e=>{let{message:t="Loading...",className:a=""}=e;return(0,s.jsxs)("div",{className:"bg-gray-800 p-8 rounded-lg text-center ".concat(a),children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-white",children:t})]})},r=e=>{let{message:t,className:a="",onRetry:l}=e;return(0,s.jsxs)("div",{className:"bg-red-900 border border-red-700 text-white p-4 rounded-lg flex items-center justify-between ".concat(a),children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,s.jsx)("span",{children:t})]}),l&&(0,s.jsx)("button",{onClick:l,className:"bg-red-800 hover:bg-red-700 text-white text-sm px-3 py-1 rounded-md ml-4 transition-colors",children:"Retry"})]})}},5436:(e,t,a)=>{"use strict";a.d(t,{default:()=>g});var s=a(5155),l=a(2115),r=a(8589),n=a(5015),d=a(5868),o=a(7580),i=a(2915);let c=(0,a(2895).A)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var m=a(1788),x=a(3168),u=a(6766),p=a(8260),h=a(6874),y=a.n(h);let g=()=>{let[e,t]=(0,l.useState)([]),[a,h]=(0,l.useState)(!0),[g,f]=(0,l.useState)(new Date().toISOString().slice(0,7)),[b,j]=(0,l.useState)([]),[N,_]=(0,l.useState)({total:0,readyToPay:0,needsSetup:0,totalAmount:0,readyAmount:0}),v=async()=>{try{console.log("\uD83D\uDD0D Fetching available months...");let{data:e,error:t}=await x.ND.from("user_earnings").select("created_at").order("created_at",{ascending:!1});if(t){console.log("Direct query failed, trying RPC:",t);let{data:e,error:a}=await x.ND.rpc("get_payout_months");if(console.log("\uD83D\uDCC5 Available months RPC response:",{data:e,error:a}),a)throw a;j(e||[]);return}if(e){let t=new Set,a=[];e.forEach(e=>{let a=new Date(e.created_at).toISOString().slice(0,7);console.log("\uD83D\uDCC5 Processing date:",e.created_at,"-> month:",a),t.add(a)}),Array.from(t).sort().reverse().forEach(t=>{let[s,l]=t.split("-"),r=new Date(parseInt(s),parseInt(l)-1,1);console.log("\uD83D\uDCC5 Creating date for:",t,"-> Date object:",r,"-> Label will be:",r.toLocaleDateString("en-US",{month:"long",year:"numeric"})),a.push({month_value:t,month_label:r.toLocaleDateString("en-US",{month:"long",year:"numeric"}),payout_count:e.filter(e=>new Date(e.created_at).toISOString().slice(0,7)===t).length})}),console.log("\uD83D\uDCC5 Processed months data:",a),j(a),a.length>0&&(a.some(e=>e.month_value===g)||f(a[0].month_value))}}catch(e){console.error("❌ Error fetching available months:",e)}},w=async e=>{h(!0);try{console.log("\uD83D\uDCB0 Fetching payouts for month:",e);let{data:a,error:s}=await x.ND.from("user_earnings").select("\n          *,\n          profiles:user_id (\n            id,\n            full_name,\n            email,\n            paypal_email\n          )\n        ").gte("created_at","".concat(e,"-01")).lt("created_at","".concat(e,"-32")).gt("dollars_earned",0).order("created_at",{ascending:!1});if(s){console.log("Direct earnings query failed, trying RPC:",s);let{data:a,error:l}=await x.ND.rpc("get_payouts_by_month",{target_month:e});if(console.log("\uD83D\uDCB8 Payouts RPC response:",{data:a,error:l,month:e}),l)throw l;let r=a||[];t(r);let n=r.filter(e=>e.payout_paypal_email||e.user_paypal_email),d=r.filter(e=>!e.payout_paypal_email&&!e.user_paypal_email);_({total:r.length,readyToPay:n.length,needsSetup:d.length,totalAmount:r.reduce((e,t)=>e+parseFloat(t.amount_dollars||"0"),0),readyAmount:n.reduce((e,t)=>e+parseFloat(t.amount_dollars||"0"),0)});return}if(a){console.log("\uD83D\uDCB8 Raw earnings data:",a);let e=a.map(e=>{var t,a,s,l;return{payout_id:e.id,full_name:(null==(t=e.profiles)?void 0:t.full_name)||"Unknown User",email:(null==(a=e.profiles)?void 0:a.email)||"No email",amount_dollars:e.dollars_earned.toString(),payout_paypal_email:void 0,user_paypal_email:(null==(s=e.profiles)?void 0:s.paypal_email)||void 0,request_date:e.created_at,status:(null==(l=e.profiles)?void 0:l.paypal_email)?"ready":"pending",paid_at:void 0,paid_by:void 0}});console.log("\uD83D\uDCB8 Processed payouts:",e),t(e);let s=e.filter(e=>e.user_paypal_email),l=e.filter(e=>!e.user_paypal_email);_({total:e.length,readyToPay:s.length,needsSetup:l.length,totalAmount:e.reduce((e,t)=>e+parseFloat(t.amount_dollars||"0"),0),readyAmount:s.reduce((e,t)=>e+parseFloat(t.amount_dollars||"0"),0)})}}catch(e){console.error("Error fetching payouts:",e),t([]),_({total:0,readyToPay:0,needsSetup:0,totalAmount:0,readyAmount:0})}finally{h(!1)}};(0,l.useEffect)(()=>{v()},[]),(0,l.useEffect)(()=>{g&&w(g)},[g]);let P=async()=>{try{let{data:e,error:t}=await x.ND.functions.invoke("send-paypal-reminders-branded",{body:{target_month:g}});if(t)throw t;p.Ay.success("✅ Sent ".concat(e.emails_sent," PayPal reminder emails"))}catch(e){console.error("Error sending reminders:",e),p.Ay.error("Failed to send PayPal reminders")}},k=async e=>{try{let{data:{user:t}}=await x.ND.auth.getUser();if(!t)throw Error("Not authenticated");let{error:a}=await x.ND.rpc("mark_payout_as_paid",{payout_id_param:e,admin_user_id:t.id});if(a)throw a;p.Ay.success("✅ Marked payout as paid"),w(g)}catch(e){console.error("Error marking payout as paid:",e),p.Ay.error("Failed to mark payout as paid")}};return(0,s.jsx)(r.default,{children:(0,s.jsxs)("div",{className:"min-h-screen bg-black py-8 px-2 md:px-8",children:[(0,s.jsx)("div",{className:"bg-[#918f6f]/10 border border-[#918f6f] text-white p-4 rounded-lg mb-6",children:(0,s.jsxs)("p",{className:"text-sm",children:["\uD83D\uDCE7 ",(0,s.jsx)("strong",{className:"text-[#918f6f]",children:"Monthly Payout System Active:"})," PayPal reminder emails are automatically sent to users who need to set up their PayPal email. Users can add their PayPal email in their profile settings.",(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"text-[#918f6f]/80",children:"Make sure the send-paypal-reminders Edge Function is deployed and configured."})]})}),(0,s.jsx)("div",{className:"flex items-center justify-between mb-8",children:(0,s.jsxs)("div",{className:"flex flex-1 items-center justify-center",children:[(0,s.jsx)(u.default,{src:"/PUClogo-optimized.webp",alt:"Pull-Up Club Logo",width:48,height:48,className:"h-12 w-auto object-contain mr-4",priority:!0}),(0,s.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-[#918f6f] tracking-wide text-center",children:"Admin Dashboard"})]})}),(0,s.jsx)("div",{className:"flex justify-center mb-8",children:(0,s.jsxs)("div",{className:"bg-[#18181b] rounded-lg border border-[#23231f] p-1",children:[(0,s.jsx)(y(),{href:"/admin-dashboard",className:"px-6 py-2 rounded-md text-[#9a9871] hover:text-[#ededed] transition-colors",children:"Submission Center"}),(0,s.jsx)("span",{className:"px-6 py-2 rounded-md bg-[#9b9b6f] text-black font-semibold",children:"Monthly Payouts"})]})}),(0,s.jsxs)("div",{className:"bg-[#18181b] rounded-lg border border-[#23231f] overflow-hidden",children:[(0,s.jsx)("div",{className:"p-6 border-b border-[#23231f]",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(d.A,{className:"text-[#9b9b6f]",size:24}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-[#ededed]",children:"Monthly Payouts"}),(0,s.jsxs)("p",{className:"text-[#9a9871] text-sm",children:[N.total," total • ",N.readyToPay," ready • $",N.totalAmount.toFixed(2)]})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:(0,s.jsx)("select",{value:g,onChange:e=>f(e.target.value),className:"bg-[#23231f] border border-[#23231f] rounded px-3 py-2 text-[#ededed] text-sm",children:b.map(e=>(0,s.jsxs)("option",{value:e.month_value,children:[e.month_label," (",e.payout_count,")"]},e.month_value))})})]})}),(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsx)("div",{className:"bg-[#23231f] p-4 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(o.A,{className:"text-[#9b9b6f]",size:20}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[#9a9871] text-xs",children:"Total Pending"}),(0,s.jsx)("p",{className:"text-lg font-bold text-[#ededed]",children:N.total})]})]})}),(0,s.jsx)("div",{className:"bg-[#23231f] p-4 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.A,{className:"text-green-400",size:20}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[#9a9871] text-xs",children:"Ready to Pay"}),(0,s.jsx)("p",{className:"text-lg font-bold text-green-400",children:N.readyToPay})]})]})}),(0,s.jsx)("div",{className:"bg-[#23231f] p-4 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(c,{className:"text-yellow-400",size:20}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[#9a9871] text-xs",children:"Needs PayPal"}),(0,s.jsx)("p",{className:"text-lg font-bold text-yellow-400",children:N.needsSetup})]})]})}),(0,s.jsx)("div",{className:"bg-[#23231f] p-4 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.A,{className:"text-[#9b9b6f]",size:20}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[#9a9871] text-xs",children:"Total Amount"}),(0,s.jsxs)("p",{className:"text-lg font-bold text-[#ededed]",children:["$",N.totalAmount.toFixed(2)]})]})]})})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("button",{onClick:()=>{if(0===e.length)return void p.Ay.error("No payouts to export");let t=new Blob([["Name,Email,PayPal Email,Amount,Status,Request Date,Payment Instructions",...e.map(e=>{let t=e.payout_paypal_email||e.user_paypal_email,a=t?"Send $".concat(e.amount_dollars," to ").concat(t):"User needs to add PayPal email first";return['"'.concat(e.full_name||"Unknown",'"'),'"'.concat(e.email||"No email",'"'),'"'.concat(t||"NO PAYPAL SETUP",'"'),"$".concat(e.amount_dollars),t?"Ready to Pay":"Needs PayPal Setup",new Date(e.request_date).toLocaleDateString(),'"'.concat(a,'"')].join(",")})].join("\n")],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),s=URL.createObjectURL(t);a.setAttribute("href",s),a.setAttribute("download","pull-up-club-payouts-".concat(g,".csv")),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),p.Ay.success("✅ Downloaded ".concat(e.length," payouts for ").concat(g))},disabled:0===e.length,className:"bg-[#9b9b6f] hover:bg-[#a5a575] disabled:bg-gray-600 disabled:cursor-not-allowed text-black font-semibold py-2 px-4 rounded-lg transition-colors flex items-center gap-2 text-sm",children:[(0,s.jsx)(m.A,{size:16}),"Download CSV (",e.length,")"]}),N.needsSetup>0&&(0,s.jsxs)("button",{onClick:P,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm",children:["Send Reminders (",N.needsSetup,")"]})]}),a?(0,s.jsx)(n.Gu,{message:"Loading payouts..."}):0===e.length?(0,s.jsx)("div",{className:"text-center text-[#9a9871] py-8",children:(0,s.jsxs)("p",{className:"text-lg",children:["No pending payouts for ",g]})}):(0,s.jsxs)("div",{className:"overflow-x-auto",children:[(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-[#23231f]",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left p-3 font-medium text-[#ededed]",children:"Name"}),(0,s.jsx)("th",{className:"text-left p-3 font-medium text-[#ededed]",children:"PayPal Email"}),(0,s.jsx)("th",{className:"text-left p-3 font-medium text-[#ededed]",children:"Amount"}),(0,s.jsx)("th",{className:"text-left p-3 font-medium text-[#ededed]",children:"Status"}),(0,s.jsx)("th",{className:"text-left p-3 font-medium text-[#ededed]",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:e.map(e=>{let t=e.payout_paypal_email||e.user_paypal_email,a=!!t;return(0,s.jsxs)("tr",{className:"border-b border-[#23231f] ".concat(a?"bg-green-900/10":"bg-yellow-900/10"),children:[(0,s.jsx)("td",{className:"p-3 text-[#ededed]",children:e.full_name||"Unknown"}),(0,s.jsx)("td",{className:"p-3",children:t?(0,s.jsx)("span",{className:"text-green-400 text-xs",children:t}):(0,s.jsx)("span",{className:"text-yellow-400 text-xs",children:"No PayPal Setup"})}),(0,s.jsxs)("td",{className:"p-3 font-semibold text-[#ededed]",children:["$",e.amount_dollars]}),(0,s.jsx)("td",{className:"p-3",children:e.paid_at?(0,s.jsx)("span",{className:"bg-blue-900/30 text-blue-400 px-2 py-1 rounded text-xs",children:"Paid"}):a?(0,s.jsx)("span",{className:"bg-green-900/30 text-green-400 px-2 py-1 rounded text-xs",children:"Ready"}):(0,s.jsx)("span",{className:"bg-yellow-900/30 text-yellow-400 px-2 py-1 rounded text-xs",children:"Setup Needed"})}),(0,s.jsx)("td",{className:"p-3",children:e.paid_at?(0,s.jsxs)("div",{className:"text-xs text-[#9a9871]",children:["Paid by ",e.paid_by,(0,s.jsx)("br",{}),new Date(e.paid_at).toLocaleDateString()]}):a&&(0,s.jsx)("button",{onClick:()=>k(e.payout_id),className:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold py-1 px-3 rounded transition-colors",children:"Mark Paid"})})]},e.payout_id||"payout-".concat(Math.random()))})})]}),(0,s.jsxs)("div",{className:"p-3 text-center text-[#9a9871] text-sm",children:["Showing all ",e.length," payouts for ",g]})]})]})]})]})})}},5868:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},7580:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},8918:(e,t,a)=>{Promise.resolve().then(a.bind(a,5436))}},e=>{e.O(0,[825,218,661,650,260,116,589,441,964,358],()=>e(e.s=8918)),_N_E=e.O()}]);