(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[756],{311:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(2895).A)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},3999:(e,t,s)=>{"use strict";s.d(t,{cn:()=>a});var r=s(2596),i=s(9688);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,r.$)(t))}},4912:(e,t,s)=>{"use strict";s.d(t,{Button:()=>d});var r=s(5155),i=s(2115),a=s(4624),l=s(2085),n=s(3999),o=s(1403);let c=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=i.forwardRef((e,t)=>{let{className:s,variant:i,size:l,asChild:d=!1,trackingName:u,trackingData:m,onClick:f,...p}=e,{trackButtonClick:x}=(0,o.V)(),h=d?a.DX:"button",g=async e=>{u&&await x(u,{variant:i,size:l,...m}),null==f||f(e)};return(0,r.jsx)(h,{className:(0,n.cn)(c({variant:i,size:l,className:s})),ref:t,onClick:g,...p})});d.displayName="Button"},5324:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(2895).A)("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},6573:(e,t,s)=>{"use strict";s.d(t,{default:()=>v});var r=s(5155),i=s(2115),a=s(5695),l=s(5324),n=s(7624),o=s(311),c=s(306),d=s(8260),u=s(3168),m=s(5731),f=s(8589),p=s(4912),x=s(1218),h=s(6766),g=s(8126),y=s.n(g),b=s(798);let v=()=>{let{t:e}=(0,x.Bd)("subscription"),t=(0,a.useSearchParams)(),s=(0,a.useRouter)(),{user:g}=(0,m.As)(),{trackEvent:v}=(0,b.Q)(),[w,j]=(0,i.useState)("loading"),[N,_]=(0,i.useState)(null),[k,A]=(0,i.useState)(!1),[P,C]=(0,i.useState)(!1),[D,E]=(0,i.useState)(!1),[q,I]=(0,i.useState)(!1),[z,S]=(0,i.useState)({email:"",password:"",confirmPassword:""}),U=null==t?void 0:t.get("session_id"),B=(0,i.useCallback)(async()=>{if(!U){j("invalid"),_({isValid:!1,error:"No session ID provided"});return}if(!q){I(!0);try{console.log("\uD83D\uDD0D Verifying Stripe session:",U);let{data:e,error:t}=await u.ND.functions.invoke("verify-stripe-session",{body:{sessionId:U}});if(t){console.error("❌ Error verifying session:",t),j("invalid"),_({isValid:!1,error:"Failed to verify payment session"});return}e.success&&e.isValid?(j("valid"),_(e),e.customerEmail&&S(t=>({...t,email:e.customerEmail}))):(j("invalid"),_({isValid:!1,error:e.error||"Payment session is not valid or expired"}))}catch(e){console.error("❌ Error verifying session:",e),j("invalid"),_({isValid:!1,error:"Failed to verify payment session"})}finally{I(!1)}}},[U,q]),M=(0,i.useCallback)(async e=>{C(!0);try{let{data:i,error:a}=await u.ND.functions.invoke("verify-stripe-session",{body:{sessionId:e}});if(a){console.error("Error claiming payment:",a),d.Ay.error("Failed to claim payment. Please contact support.");return}if(i.success){var t,r;await v("Purchase",{email:null==g?void 0:g.email,externalId:null==N?void 0:N.customerId},{value:null==N||null==(t=N.sessionData)?void 0:t.amountTotal,currency:null==N||null==(r=N.sessionData)?void 0:r.currency,content_name:"Pull-Up Club Membership",content_type:"subscription",content_ids:[null==N?void 0:N.subscriptionId],predicted_ltv:"119.88"}),d.Ay.success("Payment claimed successfully!"),s.push("/profile")}}catch(e){console.error("Error in payment claiming:",e),d.Ay.error("Failed to claim payment. Please contact support.")}finally{C(!1)}},[g,N,s,v,C]);(0,i.useEffect)(()=>{if(g)return void(U?M(U):s.push("/profile"));if(!U)return void s.push("/subscription");let e=setTimeout(()=>{B()},1e3);return()=>clearTimeout(e)},[U,g,s,M,B]);let T=e=>{let{name:t,value:s}=e.target;S(e=>({...e,[t]:s}))},V=async t=>{t.preventDefault(),A(!0),E(!1);try{var r,i,a,l;if(z.password!==z.confirmPassword)return void d.Ay.error(e("common:errors.passwordMismatch"));if(!X)return void d.Ay.error(e("common:errors.passwordRequirementsNotMet"));await v("StartTrial",{email:z.email,externalId:null==N?void 0:N.customerId},{value:null==N||null==(r=N.sessionData)?void 0:r.amountTotal,currency:null==N||null==(i=N.sessionData)?void 0:i.currency,predicted_ltv:"119.88"});let{error:t}=await u.ND.auth.signUp({email:z.email,password:z.password,options:{data:{stripe_customer_id:null==N?void 0:N.customerId,is_paid:!0}}});if(t){if((null==(a=t.message)?void 0:a.includes("User already registered"))||(null==(l=t.message)?void 0:l.includes("already been registered"))){console.log("\uD83D\uDC64 User already exists, showing login option"),E(!0),d.Ay.error("An account with this email already exists. Please log in instead.");return}throw t}let{data:{user:n},error:o}=await u.ND.auth.getUser();if(o||!n)throw Error("Could not get user after signup");let{error:c}=await u.ND.from("profiles").update({full_name:null,age:null,gender:null,organization:null,region:"",phone:null,stripe_customer_id:(null==N?void 0:N.customerId)||null,is_paid:!0,paypal_email:null,role:"user",is_profile_completed:!1,notification_preferences:{email_notifications:!0,workout_reminders:!0,subscription_reminders:!0,achievement_notifications:!0,leaderboard_updates:!0},theme_preferences:{dark_mode:!0,high_contrast:!1},privacy_settings:{show_profile:!0,show_achievements:!0,show_activity:!0},user_settings:{}}).eq("id",n.id);if(c)throw c;await v("CompleteRegistration",{email:z.email,externalId:null==N?void 0:N.customerId}),d.Ay.success(e("common:status.success")),setTimeout(()=>{s.push("/login")},2e3)}catch(t){console.error("Error creating account:",t);let e="object"==typeof t&&null!==t?t.message||"Unknown error":"Failed to create account";d.Ay.error(e)}finally{A(!1)}},L=z.password.length>=8,O=/[A-Z]/.test(z.password),F=/[a-z]/.test(z.password),R=/[0-9]/.test(z.password),Q=z.password===z.confirmPassword&&z.password.length>0,X=L&&O&&F&&R&&Q,Z=e=>{let{met:t,text:s}=e;return(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,r.jsx)(l.A,{size:16,className:t?"text-green-500":"text-gray-500"}),(0,r.jsx)("span",{className:t?"text-green-500":"text-gray-500",children:s})]})};return"loading"===w?(0,r.jsxs)(f.default,{children:[(0,r.jsx)(y(),{children:(0,r.jsx)("title",{children:e("meta.title")})}),(0,r.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(n.A,{className:"h-12 w-12 animate-spin text-[#9b9b6f] mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-white mb-2",children:e("signup.verifying")}),(0,r.jsx)("p",{className:"text-gray-400",children:e("signup.verifyingDesc")})]})})]}):"invalid"===w?(0,r.jsxs)(f.default,{children:[(0,r.jsx)(y(),{children:(0,r.jsx)("title",{children:e("meta.title")})}),(0,r.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto text-center",children:[(0,r.jsx)(o.A,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:e("signup.failedTitle")}),(0,r.jsx)("p",{className:"text-gray-400 mb-6",children:(null==N?void 0:N.error)||e("signup.failedDesc")}),(0,r.jsx)(p.Button,{onClick:()=>s.push("/subscription"),className:"bg-[#9b9b6f] text-black hover:bg-[#7a7a58]",children:e("signup.backButton")})]})})]}):P?(0,r.jsxs)(f.default,{children:[(0,r.jsx)(y(),{children:(0,r.jsx)("title",{children:e("meta.title")})}),(0,r.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(n.A,{className:"h-12 w-12 animate-spin text-[#9b9b6f] mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-white mb-2",children:"Claiming Payment..."}),(0,r.jsx)("p",{className:"text-gray-400",children:"Please wait while we set up your subscription."})]})})]}):(0,r.jsxs)(f.default,{children:[(0,r.jsx)(y(),{children:(0,r.jsx)("title",{children:e("meta.title")})}),(0,r.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-black relative overflow-hidden w-full",children:(0,r.jsxs)("div",{className:"relative z-10 w-full max-w-sm rounded-3xl bg-gradient-to-r from-[#ffffff10] to-[#121212] backdrop-blur-sm shadow-2xl p-8 flex flex-col items-center",children:[(0,r.jsx)("div",{className:"flex items-center justify-center mb-6",children:(0,r.jsx)(h.default,{src:"/PUClogo-optimized.webp",alt:"Pull-Up Club Logo",width:64,height:64,className:"h-16 w-auto",priority:!0})}),(0,r.jsx)(l.A,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-[#9b9b6f] mb-2 text-center",children:e("signup.successTitle")}),(0,r.jsx)("p",{className:"text-gray-400 text-sm mb-6 text-center",children:e("signup.successDesc")}),D?(0,r.jsxs)("div",{className:"w-full text-center",children:[(0,r.jsx)("p",{className:"text-gray-300 mb-4",children:"An account with this email already exists."}),(0,r.jsxs)(p.Button,{onClick:()=>{s.push("/login?session_id=".concat(U,"&email=").concat(encodeURIComponent(z.email)))},className:"w-full bg-[#9b9b6f] text-black hover:bg-[#7a7a58] font-medium py-3 flex items-center justify-center",children:[(0,r.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Log In to Claim Payment"]})]}):(0,r.jsx)("div",{className:"w-full",children:(0,r.jsxs)("form",{onSubmit:V,className:"flex flex-col w-full gap-4",children:[(0,r.jsx)("input",{type:"email",name:"email",value:z.email,onChange:T,required:!0,readOnly:!!(null==N?void 0:N.customerEmail),className:"w-full px-5 py-3 rounded-xl bg-white/10 text-white placeholder-gray-300 text-sm focus:outline-none focus:ring-2 focus:ring-[#9b9b6f] ".concat((null==N?void 0:N.customerEmail)?"opacity-75 cursor-not-allowed":""),placeholder:e("common:labels.email")}),(0,r.jsx)("input",{type:"password",name:"password",value:z.password,onChange:T,required:!0,minLength:8,className:"w-full px-5 py-3 rounded-xl bg-white/10 text-white placeholder-gray-300 text-sm focus:outline-none focus:ring-2 focus:ring-[#9b9b6f]",placeholder:e("signup.passwordPlaceholder")}),(0,r.jsx)("input",{type:"password",name:"confirmPassword",value:z.confirmPassword,onChange:T,required:!0,minLength:8,className:"w-full px-5 py-3 rounded-xl bg-white/10 text-white placeholder-gray-300 text-sm focus:outline-none focus:ring-2 focus:ring-[#9b9b6f]",placeholder:e("signup.confirmPasswordPlaceholder")}),(0,r.jsxs)("div",{className:"space-y-2 bg-white/5 p-4 rounded-xl",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-300 mb-2",children:e("signup.requirementsTitle")}),(0,r.jsx)(Z,{met:L,text:e("signup.reqMinLength")}),(0,r.jsx)(Z,{met:O,text:e("signup.reqUpperCase")}),(0,r.jsx)(Z,{met:F,text:e("signup.reqLowerCase")}),(0,r.jsx)(Z,{met:R,text:e("signup.reqNumber")}),(0,r.jsx)(Z,{met:Q,text:e("signup.reqMatch")})]}),(0,r.jsx)(p.Button,{type:"submit",disabled:k||!X,className:"w-full bg-[#9b9b6f] text-black hover:bg-[#7a7a58] font-medium py-3",children:k?(0,r.jsxs)("span",{className:"flex items-center justify-center",children:[(0,r.jsx)(n.A,{className:"h-4 w-4 animate-spin mr-2"}),e("signup.creatingButton")]}):e("signup.createButton")})]})})]})})]})}},7022:(e,t,s)=>{Promise.resolve().then(s.bind(s,6573))},7624:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(2895).A)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},8126:(e,t)=>{"use strict";function s(){return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s}}),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}},e=>{e.O(0,[825,218,661,650,212,260,116,589,441,964,358],()=>e(e.s=7022)),_N_E=e.O()}]);